using FastMultipole
using FastMultipole.StaticArrays
include("gravitational.jl")

source_x = SVector{3, Float64}[[0.8531339895067289, 0.35038980041315615, 0.04955642038233832], [0.7643243242864052, 0.25799974341570464, 0.09886595914439122], [0.8022631927736507, 0.2666914509393149, 0.083516337260786], [0.8657909336109841, 0.31603699662049634, 0.04788160994007007], [0.8684513241765038, 0.2703464993578133, 0.09184187232287966], [0.7708946808705823, 0.31674475429385507, 0.07420793933889758], [0.7815034276703229, 0.2693617578156825, 0.11073049588974382], [0.8722724871405212, 0.2590746814284296, 0.00414738749473853], [0.8676907766984012, 0.2983756602640737, 0.011075014549916107], [0.8422701640375254, 0.2612596471997054, 0.00943247756425536], [0.8676268212653656, 0.2562760108268294, 0.10776721245094167], [0.8220118144254122, 0.3664748985844275, 0.0338829999486403], [0.8351898560854609, 0.3195076181684754, 0.10531475817190705], [0.81700337466989, 0.3369811374898699, 0.11092403650490601], [0.8710348562146124, 0.2934311829604944, 0.09042397369978417], [0.7900601500811512, 0.28253663447180455, 0.07210498941878607], [0.8216021983735806, 0.3206890311161583, 0.028851281763148218], [0.9526905459165959, 0.2989696304229371, 0.030063717148163693], [0.9045468936352645, 0.37341836457968236, 0.09124078198182273], [0.9068705218305401, 0.3247327983328402, 0.11427810563008722], [0.8876859335212516, 0.31281504369433, 0.11070027743518562], [0.8942201193870407, 0.2688210506928307, 0.00837736850669768], [0.9424355278672034, 0.34038867534978157, 0.11396871486472238], [0.9720445623963929, 0.3132943353233668, 0.03597518299074376], [0.8830801561475181, 0.2891709635992993, 0.01677078749536942], [0.9771430185726223, 0.3690663017895184, 0.02237717995357813], [0.9269612313775788, 0.28585254573504837, 0.08454454306269055], [0.9694522829426268, 0.3264182468069714, 0.1137463323802026], [0.9420656621769254, 0.28695684338250205, 0.034979009283927276], [0.9440434272194151, 0.35674696081326807, 0.07643215952139171], [0.9116580359381589, 0.3579614224435326, 0.060930549609889306], [0.9926318973582994, 0.35939218300690645, 0.0865770291140655], [0.7500774806694582, 0.39421415825128225, 0.09010353777784441], [0.7513039548034739, 0.42346830809900127, 0.12409666140274722], [0.8077043596470426, 0.46909571212650314, 0.11902829945444848], [0.7627402310232899, 0.43737720644788547, 0.07535718886397313], [0.8170176307051613, 0.41453558633467347, 0.11998722873540002], [0.755891633007431, 0.49269091282929545, 0.026098658205129133], [0.8211950409465768, 0.3804895300772394, 0.05188355242209963], [0.7754770822982405, 0.49513710680087386, 0.006488413832757001], [0.7591249276818226, 0.45336945345140633, 0.02612838007134466], [0.8235269457594079, 0.4348197245408294, 0.02908665262418475], [0.8446540156462091, 0.49174357872477326, 0.08809022889568374], [0.85611001378092, 0.3959993294613373, 0.0713190294577638], [0.7583781347015015, 0.4428384508278843, 0.10127145552589933], [0.7538266397846972, 0.3854776517623003, 0.03824954386390844], [0.8379097088488299, 0.4781720819328633, 0.11000181167806977], [0.7996214498678814, 0.4007039064956496, 0.011846379441380783], [0.8652626027855528, 0.41470215748193584, 0.03018100409938751], [0.8691061157042491, 0.40331886888134805, 0.0656727729507286], [0.8362893081912119, 0.38198293186113264, 0.10787183941443801], [0.8233779595804782, 0.49012455959797874, 0.11374927167485771], [0.7893994894603195, 0.4687057402407877, 0.02467499889105662], [0.8722152148130153, 0.4469760188192182, 0.04930963660946075], [0.757887869119168, 0.4799364896233693, 0.0343784464978526], [0.8240030884903403, 0.42252455666286903, 0.03196773289406829], [0.833756599532383, 0.39955852287444027, 0.09210051593876589], [0.8723145131584724, 0.48082221875846887, 0.09753013022691714], [0.8633952235792665, 0.40698412774606496, 0.04478630517683646], [0.7737831545860028, 0.408501441497487, 0.11097399791151574], [0.8319978314123847, 0.39610848723910863, 0.09900283372640872], [0.8024960884784114, 0.4899793939874889, 0.01967464350378545], [0.8437539955049921, 0.44449885460095995, 0.11458975734234667], [0.760001841978369, 0.437285225114739, 0.11065565770227948], [0.9287887981545923, 0.48372144298584185, 0.08281582621339545], [0.9664645296367287, 0.43224468732670696, 0.06514584353923791], [0.9422538344930951, 0.4320665551733891, 0.014959739278127326], [0.8955095289731515, 0.4818174193364819, 0.021241906052614], [0.9782526903775861, 0.4919477747195231, 0.01547129999590613], [0.916588837182146, 0.497242577365661, 0.06868230479812898], [0.9957978793717158, 0.43468325515679596, 0.11334812394087357], [0.9438389256863945, 0.4894500482498051, 0.013469347774978213], [0.9865913700634358, 0.49877427218153825, 0.053867835787560825], [0.9082769176661201, 0.3890962425207679, 0.1029084200030097], [0.9862124628741246, 0.47086717937038014, 0.12104136560484491], [0.891090668838633, 0.4936187136888254, 0.015829517478099575], [0.9899729719048991, 0.397609698035131, 0.023749777418280105], [0.8806609950645532, 0.4399305405434297, 0.009664475899167968], [0.8858511706800597, 0.44960676597769944, 0.030137979220068], [0.9900946822292249, 0.42969946372238144, 0.042196917423175107], [0.8855226021027524, 0.4223105187804451, 0.0862115746341694], [0.9762190236066651, 0.4157732083798005, 0.09709891001825055], [0.9322745504911671, 0.3792092849410986, 0.09329288589453821], [0.9178522295615785, 0.377514390724628, 0.07290393531649242], [0.967357730276189, 0.3901538778267891, 0.07165680328860113], [0.9834621549220468, 0.41727704493652373, 0.047754436698472125], [0.9558770774141637, 0.4405598346624827, 0.0040436918758475215], [0.9127822426210299, 0.4417033818615054, 0.047441325334000695], [0.9736960261108177, 0.4571532834773908, 0.06292650430935243], [0.9338092254193088, 0.39724942922707007, 0.017692252035901967], [0.8058251495215947, 0.3360837245086734, 0.14950071647790186], [0.8468043196987073, 0.3378545827470677, 0.14635708411682635], [0.8745869863111255, 0.29834232639772684, 0.20384991199861546], [0.8686390654404345, 0.263460208699271, 0.1737626886886755], [0.8727806230295525, 0.31958140955703807, 0.13757183553465646], [0.7904700669176834, 0.3459599034634975, 0.19900182185096837], [0.8357962970460905, 0.2536677311476514, 0.1666868094223486], [0.7535762456388141, 0.3109019867775019, 0.22714798902578337], [0.8314288031907473, 0.35083320464793, 0.19061914033508165], [0.8717271246234313, 0.3738597348482574, 0.16752118178903963], [0.8353584062230502, 0.27425410872161005, 0.20986468208260645], [0.8679912157239454, 0.3155376185338271, 0.2250835910144221], [0.8524114803341886, 0.2527939345601363, 0.19741480988046323], [0.7715038241991788, 0.27213264241274193, 0.20500041322302553], [0.8168031664762648, 0.3468530662893008, 0.16941656110077452], [0.7940988113161088, 0.3457269870284011, 0.12775424117823253], [0.8165972490098548, 0.3585614524248468, 0.20990707351157478], [0.7821092687188035, 0.291190563397111, 0.23636741252859195], [0.8246863819629445, 0.2755157074666592, 0.1634338524379021], [0.8583740068712397, 0.3440313058554819, 0.12928386618184995], [0.8439438692470433, 0.35195117252150265, 0.20077271609705183], [0.8257748774593767, 0.28045025780099364, 0.12700052424734432], [0.807005957310509, 0.35056088432147015, 0.2073005802992094], [0.8808675895891549, 0.37312234410047507, 0.18989908804881983], [0.9186728171698993, 0.3078255377991652, 0.20045418066599163], [0.9291844907944462, 0.28261435995903317, 0.24162569235508302], [0.9378904956278592, 0.2718828417304062, 0.2331965787414676], [0.8962761406864962, 0.251629957460355, 0.12683591984431664], [0.8754744863271882, 0.26417840427586237, 0.15928251563199558], [0.9699947653117866, 0.33056959292772925, 0.20482673391321393], [0.8901732626326504, 0.36879669487313294, 0.18479634155383529], [0.9046980984509377, 0.2723897407807848, 0.17721092671678773], [0.9625340717898392, 0.2867485916492035, 0.240954051987604], [0.9102923663060957, 0.30667534635286753, 0.12661668103034462], [0.9840600330021387, 0.3633497164899526, 0.14839825554126318], [0.9824205102786014, 0.3303754009012406, 0.23281635802206457], [0.8913132038561806, 0.2638230371709288, 0.21524783921682844], [0.7529789793956462, 0.468277406176132, 0.13514572038888972], [0.7606902104197539, 0.4131714340792597, 0.23646595357586342], [0.7850254082614048, 0.4925486809487125, 0.1443797586680089], [0.834389126051354, 0.45429010332335007, 0.23564318765439418], [0.7971822822523182, 0.43094398425794145, 0.20569107922962437], [0.7777856491222647, 0.4650909679054289, 0.1966295228638858], [0.8448636194434298, 0.49012102913841915, 0.18026631487729372], [0.7601307424280194, 0.4554095035513753, 0.24191922993604298], [0.8716346869111522, 0.41473434685839083, 0.20325536229005758], [0.8677271884112995, 0.413520918006564, 0.1737097397429328], [0.8370239230404053, 0.3867492969591485, 0.23751167017538521], [0.8573931026897564, 0.4521312709892287, 0.20753509986211627], [0.7516903096763088, 0.3833589868582561, 0.24627797382491468], [0.7940899248993333, 0.43542584963679654, 0.22814830204805858], [0.7540088477549474, 0.4400188098821807, 0.1286677505184316], [0.8330045640571941, 0.4038478020203794, 0.14197006260118583], [0.8730817573861757, 0.46222657310213466, 0.2093079954023278], [0.7913309075786393, 0.42280917163214127, 0.21096712222805536], [0.79914680069617, 0.41534171279684573, 0.14191913416922908], [0.8692733811872316, 0.45698043216643536, 0.2221139884010649], [0.9517945827135049, 0.37584617208916593, 0.19191332475865375], [0.9960713510286451, 0.4959149980434647, 0.18457357083797898], [0.9819772843753408, 0.39824350147752074, 0.13123091646764662], [0.8859977225958124, 0.420737567953952, 0.15872716224392192], [0.9160615706445002, 0.4521591507383337, 0.20754246414391875], [0.912033467318738, 0.4407792569941077, 0.19888327816655682], [0.9911301642251983, 0.49164050491354305, 0.22568513945450908], [0.9915095749142955, 0.4050215044983453, 0.2135247245366666], [0.8827195711726902, 0.39532933724984864, 0.18949949580218028], [0.9243157082136314, 0.47799679634138115, 0.22652732363850703], [0.9460714559075423, 0.4039224498767119, 0.1519082898032854], [0.8768016031409444, 0.4949586315060045, 0.21996948117180182], [0.9764270619445463, 0.3807129318104291, 0.15056059530809884], [0.9770530199380358, 0.46060690445327546, 0.21160793103392772], [0.8977505849623928, 0.40156186647591885, 0.13438408692068493], [0.8795892130676215, 0.4252812674963563, 0.12945881253854996], [0.8909519247188714, 0.3867772697644396, 0.22240160152548527], [0.9918222812482881, 0.39138219565318977, 0.13843387609236513], [0.9535248448551907, 0.41067026700608333, 0.21002888641498285], [0.8895711793851261, 0.4654110738714221, 0.19874176921669906]]
source_m = [0.5185146620672383, 0.6713886244551921, 0.6675682591486468, 0.84997794692453, 0.37004912806381807, 0.4327520366445151, 0.8965815334107283, 0.631979062080044, 0.17654536465867887, 0.6695010125467689, 0.8657540557983909, 0.7414557953460309, 0.1299107061771435, 0.6417222921719016, 0.3801892472953601, 0.79013921468593, 0.4289470477721141, 0.327136330560549, 0.5232985634139603, 0.43776169553098276, 0.5441796429670432, 0.9754805475298679, 0.725100624195882, 0.8057707414203096, 0.012752306132399305, 0.3813427852215786, 0.43310052572516333, 0.3955751350800334, 0.8043149496418305, 0.42142139507758525, 0.14847137443074265, 0.6786724936102906, 0.17512172777624924, 0.5419590098852387, 0.46185693353405355, 0.8843303807664347, 0.7847036189944587, 0.014327148384369548, 0.5204305903532952, 0.10432448187342369, 0.8800930355864945, 0.9182631748648986, 0.41842415818721623, 0.40415271132860553, 0.6101963865154163, 0.014232451520244216, 0.8571384098880398, 0.7201665421272365, 0.5063490826645257, 0.7920375495263008, 0.48962433603061695, 0.5984284474982126, 0.22438724031205037, 0.967844124993524, 0.6890350777608205, 0.9965828921357109, 0.7779714011249633, 0.9345077212780984, 0.16506338581990276, 0.14415041219807245, 0.1268704705247743, 0.6040651773748523, 0.8590600997170885, 0.3567578355805786, 0.5634985346880531, 0.9917449595067938, 0.875201345716033, 0.36274429564007415, 0.6590968051470399, 0.3502567963402343, 0.4209485388436841, 0.21933386391576026, 0.9234260482940332, 0.4713351853445815, 0.4729659584526936, 0.3105031924454066, 0.7824339866298248, 0.974049201625889, 0.4331668032623779, 0.1419801871403883, 0.8339813534102911, 0.6560527252180062, 0.6486252177264182, 0.6715237511601012, 0.4786143691785907, 0.37906737469598173, 0.2262766828170324, 0.761233373303368, 0.4866136673307374, 0.35782030627311057, 0.4141807947890096, 0.057447203399265345, 0.6528708936246551, 0.20202193819376912, 0.3931815103549502, 0.5126789027558992, 0.4795411337285679, 0.8843547064916434, 0.3209357084561377, 0.37316203177495677, 0.6007537667655356, 0.06351215271595112, 0.20881379924462717, 0.21842948359955783, 0.4052525778466126, 0.8131901334554222, 0.6680915334830285, 0.2972663575737047, 0.9892553022095187, 0.5821056684435222, 0.672317117055034, 0.514333604012908, 0.7185221200798528, 0.3856873023831733, 0.7407208994127448, 0.6694963593053607, 0.45980845647953317, 0.7166520167003791, 0.8961414401519354, 0.7322816147654446, 0.2780527419027182, 0.6962662499184995, 0.6561520745419629, 0.8493406516075533, 0.37441975649693604, 0.371458770592509, 0.5738447659064853, 0.46341054701902096, 0.7656221858519935, 0.026356138301257714, 0.7053177220813707, 0.5529082894403589, 0.12219449101422764, 0.8821955325146668, 0.7658814111650355, 0.5467441821649156, 0.7287247927950772, 0.16100446923069833, 0.36536829423070905, 0.32480829272923795, 0.7369179539807593, 0.05084854044373199, 0.2819662879025333, 0.4523090780397472, 0.42277153519945376, 0.5614089968569961, 0.9595952459722304, 0.8360094197594151, 0.9190851132525282, 0.6261558806929822, 0.8942087302445243, 0.2004315718514933, 0.6847047420239879, 0.34566565333631716, 0.024131199347622867, 0.5670047615922258, 0.8132798609174957, 0.5604581714954594, 0.45017314826779, 0.5424263128821232, 0.016331068932349146, 0.6232756843592309, 0.84965074797214, 0.18626036865330642, 0.4991929532152416, 0.16889984389317048, 0.7214873127053313]
source_r = [0.000956861916670338, 0.0009643897477376042, 0.0015397872716840502, 0.0018878746558422062, 0.0009346878742346739, 0.0014705995214432702, 0.000489557000679654, 0.0007259217865364826, 0.0013979344949373203, 0.0008761903800864747, 0.0004736602126967288, 0.0015708364765693037, 0.0008110111915337706, 0.0010421436833123036, 0.0020585561772936112, 0.0020849911729979398, 0.0018996509539373513, 0.00037551739982498553, 5.132219255586002e-5, 4.751227733149147e-5, 0.0008059573823580883, 0.0007690716282166636, 0.002080042472545756, 0.002294420370727113, 0.002191004254152122, 0.0018617049600263412, 0.001724623261536649, 0.0002885248416504978, 0.001887163110677041, 0.0005866604639695808, 0.0016581545988411097, 0.0006080106028651718, 0.0022107408153116278, 0.0009597720259348224, 0.0011533665031179868, 0.0017508790170084878, 0.0005596180306496384, 0.0018461731953890032, 0.00026889046075272827, 5.2453365600560975e-5, 0.0003969042797230189, 0.0004586053128063453, 0.000978838854770623, 0.0021762712798284608, 0.0003290860739324307, 0.00014167422355854348, 0.00018180142300032844, 0.001328958153148173, 0.0006020476224029862, 0.0017051047592964892, 0.0008892968775999727, 0.0006231535921198695, 0.0011908625243447668, 0.0009711719509360151, 0.0012777002303387794, 0.0014289230189518172, 0.001361432053748312, 0.00048740978327637264, 0.0007312481020389505, 0.0007279478909396546, 0.0001974109733366494, 0.001502213336375055, 0.002183282650483912, 0.0002835156528543043, 0.0014465465148989004, 0.0022267325868397074, 0.0015810316329576174, 0.0006752569051355126, 0.0011590862752664745, 0.0016006263750496274, 0.002135731770438066, 0.00028711020355933435, 0.0007979963646911616, 0.0011974666249384355, 0.00018081316225176106, 0.0005621631837832616, 0.0014779300036483808, 0.002216443333451103, 0.0016374735751513644, 0.00230218144748737, 0.001202908146425627, 0.001958684452424842, 0.0001232094208850742, 0.0013691186721752225, 0.00041579486902998527, 0.0004775667775127836, 0.0001636273847246289, 0.0018964306647930905, 0.001490051532265229, 0.0016570637004503673, 0.0019475678376914864, 0.0011907936436599213, 5.295307483461648e-5, 0.0007753738987449402, 0.000950245589569789, 0.0009467880520122213, 0.00012161460085000982, 0.0005881858443611299, 0.0018540907129008964, 0.0003897153418161584, 0.0017555034104520574, 0.001590416705644697, 0.0018692057380608176, 0.001393398701533156, 0.002125966554640087, 0.0005264153119820101, 0.0015168417036287957, 0.0003304435469794223, 0.0003853516260462181, 0.0009063968419054854, 0.00049823366350893, 0.00025096026895869445, 0.001172136778212889, 0.0018824382433599131, 0.002080537838145237, 0.001492794236167618, 0.0015138861718147266, 0.0019253502237709698, 0.0004736906848875247, 0.0006358706808237628, 0.001649548194362604, 0.002245934611553089, 0.0009409386356582201, 0.0013368844599463585, 0.001330139334423435, 0.0005544729915443787, 0.0012291879522893798, 0.0008940536761633715, 0.0016527174354061666, 0.0015003719971200496, 0.0010548756811425703, 0.0017171540563484613, 0.0011625645223025695, 0.001053556325456125, 0.0006986633647820828, 5.1787609823311136e-5, 0.0011898849274924574, 0.0006394438315377243, 0.0011423439198671812, 6.015961582424466e-5, 0.0012564555734508732, 0.00020712916987957977, 0.001295619799409231, 0.001366692983626257, 0.00207348141243643, 0.00047382083250254294, 0.002196770607673434, 0.00016688139171593258, 0.0002818521047863685, 0.0016592301334171313, 0.0002949493631727823, 0.0016591883416697533, 0.0016672219350497748, 0.0009631340805994475, 0.0019529941260723518, 0.0006942171706298478, 0.00021469414420415152, 0.0019654247516071224, 0.000975840246597717, 0.0015786409624150251, 0.0008028314141542309, 0.0017826718104091519, 0.000851039971746709, 0.0018629700177576214, 0.00011145192810053508, 0.001867337591072527, 0.001185613805497075]
target_x = SVector{3, Float64}[[0.2578732973577543, 0.7502276709566432, 0.5875509623313736], [0.3523788380537781, 0.7967336731584311, 0.568930340226365], [0.33986128302451524, 0.7698433382552117, 0.5981902522527435], [0.2724440979858799, 0.8081101920346541, 0.6085519668185577], [0.34994940509882944, 0.8154143078292048, 0.6170063267085141], [0.3302825701109289, 0.7622200050262571, 0.5296563145079792], [0.27492120959898214, 0.855558305843227, 0.5343890128729266], [0.34424632687025825, 0.8702978923748842, 0.6135724903533168], [0.26220542202823016, 0.7832181904716065, 0.5292011134112489], [0.3365116197859961, 0.8331486265453237, 0.5917056603849989], [0.37045191716167136, 0.7514059257506266, 0.5134031664786821], [0.3269775037581699, 0.798904518711169, 0.539149990487396], [0.26486010165665497, 0.8321140069471282, 0.5275925276686754], [0.32212152027246455, 0.7730714496238716, 0.5916773435048784], [0.26434200036044064, 0.8539715110019752, 0.5457247762506945], [0.35351147705016595, 0.8183476110122253, 0.5433135112343425], [0.32657755993374316, 0.7799014221333657, 0.5291349105409945], [0.31154078545272457, 0.8507572729747456, 0.6189265934183933], [0.29039413999066166, 0.8486756392120678, 0.5238318291367002], [0.3476123499662849, 0.8418053202219137, 0.5645763796606598], [0.3487863868084057, 0.8137346301876945, 0.6170126446120746], [0.3535307650420778, 0.7595359206155007, 0.5278482051071778], [0.31375473519584407, 0.8038615434636946, 0.5855313285101108], [0.35725780738406454, 0.8696282720090607, 0.5256724296889116], [0.3376058577564338, 0.7674337141646089, 0.5847389436103447], [0.2793257824465424, 0.8255943822022326, 0.5516815138386754], [0.37443194876862895, 0.77111372382665, 0.5105835331824151], [0.2769956693690091, 0.8615629820730708, 0.5933481509937756], [0.4334026922309808, 0.8671023913833278, 0.5560289118404291], [0.40498079722680025, 0.866066215643135, 0.6206624627954581], [0.44932997790390106, 0.8087211081076082, 0.609848722815446], [0.4454557896760286, 0.7932380069459243, 0.5127593948372134], [0.4946814206574345, 0.7508589166262305, 0.6019128230678726], [0.46929880776855915, 0.8055185351349069, 0.5243918894362072], [0.49660973346232085, 0.8370595875438467, 0.6139684909782726], [0.3790526053003739, 0.7565997690899589, 0.5221636240393692], [0.4735110453473408, 0.7892393974109939, 0.5301040686121395], [0.38525225310853284, 0.8330812637172444, 0.6148708070215242], [0.3830644054304282, 0.8063314936816462, 0.5193840462139369], [0.49851227907234275, 0.7854497483813773, 0.5088980477014152], [0.43416484255582644, 0.865581391198988, 0.6165556562766065], [0.4029979572137311, 0.7991061766663784, 0.5453686036812527], [0.45219028847414255, 0.7511476407607646, 0.5186981104217967], [0.49077052007085475, 0.7647085673524046, 0.5397297423619383], [0.45675234499439743, 0.7802939681493839, 0.5576630950485921], [0.4174176536660905, 0.778786497022782, 0.6056937896534957], [0.41042176291501087, 0.840741504764337, 0.5542982456112143], [0.3905458298174731, 0.8327280196312736, 0.5431916685849297], [0.4999529502939942, 0.7518074590900287, 0.5055679236636919], [0.49869828790451853, 0.7975601163418222, 0.5308205028000165], [0.3899697047268511, 0.7652799148351108, 0.6201213860746477], [0.39601397139225736, 0.7668854997962986, 0.6221177873559212], [0.4487171064522816, 0.7609168434759613, 0.6203982055384337], [0.41857138836012464, 0.7635438767058687, 0.5925124302579191], [0.4301609954509297, 0.8216051996294007, 0.5241751089029258], [0.31982210327735494, 0.9065047344889146, 0.6124952476092198], [0.2625757821939807, 0.924523855544414, 0.5861716504889027], [0.30933311996834045, 0.9154663554731775, 0.5144616097861718], [0.2720152061064004, 0.9101615589257342, 0.5572388949078412], [0.28400061118267583, 0.9962337496858459, 0.5516263681551604], [0.3549011464407009, 0.9106690533767245, 0.5002398231114263], [0.34873802670793574, 0.8924025481673497, 0.5776100452543784], [0.35414856429219854, 0.9680505290798744, 0.6012373589043365], [0.3376271412380676, 0.8852593720750268, 0.5207656145325597], [0.3400070988680459, 0.9443643842758376, 0.6006144944321193], [0.3437893113119337, 0.9540766396026688, 0.53139841487915], [0.264624073560343, 0.9347524248873008, 0.5170052200288575], [0.299552188880975, 0.9747772477239839, 0.5811904458618556], [0.2926706689320073, 0.9220389202176306, 0.5197453199712785], [0.32940332921923177, 0.9605788407821628, 0.6063905171228915], [0.47359968032817923, 0.924969269095564, 0.5052760820970852], [0.4540082999769802, 0.8939344046586268, 0.5788513723884815], [0.45095978479464716, 0.9609209446971939, 0.5489321885504385], [0.3997869737387191, 0.9746179567805936, 0.6011896815632382], [0.481420243434985, 0.946749976424157, 0.5588736077777123], [0.48765864979024787, 0.9191721456657044, 0.5136486061947995], [0.39970821408809065, 0.9949228337953792, 0.5671048135133374], [0.388278703351316, 0.8798525479981075, 0.5708536385244181], [0.4339445416622638, 0.9469743482707755, 0.547658498409607], [0.43497903561478357, 0.8790505836548048, 0.5332472231906454], [0.49056324003864626, 0.9030871559860079, 0.5007709231856047], [0.471468772886779, 0.9689993436204124, 0.5578900320720992], [0.4227064790929691, 0.9059365770189899, 0.5170850477746891], [0.4211019643957278, 0.9125735284000264, 0.5425942382085199], [0.4376098066882823, 0.900668958516922, 0.5093210235206579], [0.43876033692033056, 0.9610320643751283, 0.6082017319006956], [0.45736756134635304, 0.9853913251489272, 0.5144704567457884], [0.3784252933325579, 0.8967492572802327, 0.5939476410533265], [0.41029052276186206, 0.8999284024962642, 0.5076057044790837], [0.46805965379279524, 0.886476537260399, 0.6162654614422214], [0.29834076113518426, 0.8149195619345481, 0.7192989085487776], [0.27297465396391396, 0.8564598984185261, 0.6518293746604579], [0.27912780594112463, 0.7669168070633205, 0.6869218473104955], [0.30471714669987404, 0.7684200157750641, 0.6902217544503013], [0.33640866357527865, 0.7669055412501012, 0.7183525478600145], [0.29026890109002923, 0.8268774335329434, 0.6583816537477573], [0.37418444200012635, 0.8279225224118485, 0.702129596192258], [0.3421534604107862, 0.8332936516197068, 0.7408915957495982], [0.2575631678566468, 0.754179103417431, 0.6347044318324797], [0.2741248988866769, 0.8628083758618638, 0.6290356571066325], [0.3667800619274608, 0.8479957174614168, 0.7056939518874055], [0.3132006971453455, 0.8546184514429007, 0.6558218533798376], [0.2768988117214799, 0.7694128651799503, 0.7022570255334205], [0.2913953925296675, 0.765396360875974, 0.6862432158457386], [0.28838071217542194, 0.8129531569880613, 0.6628851754091634], [0.2658220744523949, 0.7786211793485501, 0.6676676501345316], [0.2965258409693613, 0.7790079714304095, 0.7153810407754693], [0.2729709813669138, 0.8363010627869286, 0.7145010708908207], [0.30563202530548306, 0.7561461814929418, 0.7425308684515743], [0.28777255486426345, 0.8146493851993355, 0.7230700957146385], [0.39392111937641616, 0.8052665710284069, 0.6391366751112615], [0.38230890803131123, 0.792890674264657, 0.6882360167248467], [0.4654809123587439, 0.7955156385364052, 0.7477419918111691], [0.48382717502376615, 0.7614128621979676, 0.6634731358112151], [0.4008539239044516, 0.793031961626309, 0.7050229244316383], [0.3758843588587467, 0.8130585769344755, 0.7025068318073724], [0.4293044250486795, 0.8493563800936399, 0.6897066141791598], [0.4486391079970605, 0.8203974817899393, 0.7479306589931336], [0.41492664377799526, 0.8299131420394825, 0.6400026124596163], [0.4932854206629036, 0.8176665062655624, 0.7459676102100462], [0.48013956519675427, 0.8511949922364701, 0.6805891672447381], [0.42055414632101096, 0.8659691002719857, 0.7006742507549429], [0.4160479120671967, 0.7874413767609972, 0.7228207199412942], [0.454971805159722, 0.8288945913020453, 0.6640318977992546], [0.48306749652745895, 0.822900950442979, 0.7116174552745176], [0.4457970219868309, 0.7763650926979925, 0.7111031535964919], [0.3892991827004737, 0.8167136150010759, 0.6748994161009327], [0.39237469143533243, 0.7655616254287884, 0.7333579957743642], [0.38772535008882214, 0.8072377255268726, 0.7082023048732697], [0.4375024912213623, 0.8731118368204687, 0.7241963279459224], [0.29710733073874696, 0.9246011152906826, 0.6632394439518473], [0.35792371895717967, 0.8788547561915624, 0.6274650130632782], [0.33610196980093543, 0.9390302375147809, 0.7358396225254002], [0.3298020268109887, 0.9891783519631174, 0.6598737593972024], [0.27091457985725365, 0.9900079784815095, 0.6976169073370679], [0.32759784622167354, 0.8904024026357868, 0.6907468558784834], [0.26561749116241584, 0.9473054873645229, 0.6431807060788313], [0.33866216289519635, 0.9960425986704392, 0.6275031148913944], [0.2540775274613989, 0.9057556334630583, 0.7075166653895892], [0.28949083227536154, 0.8858343294030776, 0.6965542548412886], [0.31002143606420207, 0.8917711639804928, 0.7225196551041623], [0.29565396074867645, 0.9247315668939685, 0.7006869354805844], [0.3459729353126353, 0.8920569148137272, 0.6487598789626177], [0.3232155192186297, 0.9257894266371142, 0.6915229120817411], [0.3352218483031377, 0.889239124933361, 0.717525209513349], [0.27008570296780166, 0.9675437757542616, 0.6379667923355777], [0.36524698508269315, 0.9135970108300865, 0.7116667912915666], [0.33262390145049137, 0.884822906747976, 0.6261628829623036], [0.42681326492892313, 0.9051795931982054, 0.6775951249583034], [0.42898520969883325, 0.9272612397393669, 0.6447323771947896], [0.4210327180751736, 0.916110054574078, 0.749700081078917], [0.4644179687052311, 0.8994232125058723, 0.7102555708405774], [0.4460990221397735, 0.9776875192377849, 0.702177637607583], [0.38456863225669613, 0.9224922778194395, 0.6710912880028637], [0.38035711406748796, 0.987568155422439, 0.7127936746659268], [0.4187058209323934, 0.8903993115458623, 0.6569560891412142], [0.43247840820237826, 0.9360356680669761, 0.7363845357545441], [0.47448964799867366, 0.875975938978735, 0.6971973281822104], [0.4678587492138562, 0.9588540176042598, 0.6493256423050611], [0.45191960883756366, 0.9383822223470212, 0.731446761539406], [0.40987881071042365, 0.9690161843503838, 0.6512084620795221], [0.4624724736450211, 0.9268747417027309, 0.746455783462294], [0.47501590663548277, 0.9820853117392648, 0.7332571578381305], [0.42095105646333764, 0.8898134769798992, 0.713881338138423], [0.4811829971836653, 0.9138231868381459, 0.6385761489644163], [0.47248795829418566, 0.8913197804756052, 0.7404777572089823], [0.4378294679510908, 0.9446229323670071, 0.6759227302895383], [0.44623305472488906, 0.9142798619397069, 0.7423243247613897]]
target_m = [0.7881306819873707, 0.23110036468449546, 0.8268374794819708, 0.19702897745212922, 0.6064352990513743, 0.10189919051927177, 0.4435857363869371, 0.3491732181283075, 0.6504371780243989, 0.5969663416775228, 0.11642012670866109, 0.9219947318594782, 0.7685995678334259, 0.11807662198444224, 0.8789890242650521, 0.492159055952579, 0.9566869173925436, 0.446647357698419, 0.4606482086035436, 0.7159497918144062, 0.952616367716834, 0.24282705114916248, 0.19260035016142718, 0.6405178377186389, 0.7985600710571618, 0.33483383517429544, 0.254136584914076, 0.4115951980137641, 0.023320167569572448, 0.6291751471989254, 0.2906918191574247, 0.38330711583786425, 0.36806150715428987, 0.1558596866766182, 0.7627243573963699, 0.6589637788945062, 0.8385453500714528, 0.06850549840427711, 0.12305330968311345, 0.90133116731248, 0.509205401343038, 0.14990456409543318, 0.3708372617075789, 0.8228181424487145, 0.42775363052344617, 0.05287349391067364, 0.9175981033237044, 0.9837212252895153, 0.5400920063662462, 0.8217250007391148, 0.01184577539084497, 0.8454785468109359, 0.16894411445356072, 0.780585214272366, 0.702916136591448, 0.8158697893116374, 0.9807780345685143, 0.9070195391983685, 0.13652742730175804, 0.15104666583736115, 0.47133590663668945, 0.6274934405883077, 0.027377015579689634, 0.11076852931196945, 0.42501806089842586, 0.8795000648883062, 0.9097106362726373, 0.12449137464326632, 0.05873263101455317, 0.2840289708568662, 0.531945627903446, 0.10124121306345246, 0.9539192778477096, 0.4355308572658746, 0.7285059678639662, 0.9723281419519062, 0.08450411807188352, 0.21446535911007114, 0.12587921357305631, 0.38137305543635636, 0.5071900968399022, 0.8886651817314771, 0.8995415158509256, 0.9457996002982332, 0.8950860818506999, 0.4362576032538412, 0.32829933612448103, 0.10161006147392859, 0.3302587640230209, 0.6620321669107474, 0.17689335268130646, 0.3425703229118956, 0.6492499283119475, 0.6618051599371407, 0.5662086878868371, 0.8963931898057077, 0.7979621267937266, 0.5245861440475555, 0.7012126453295383, 0.6322584201023359, 0.40835890706620903, 0.31410230717805665, 0.9939864223109913, 0.9737713209068188, 0.6114369005839186, 0.19666519663312976, 0.8242706008479217, 0.38547516685215755, 0.04235148963801272, 0.6900050632879791, 0.28526666192551975, 0.972179126430179, 0.9058041768435556, 0.5410797204731966, 0.4616298064140977, 0.17858410940923597, 0.8894823559195097, 0.7374394477962911, 0.7132166719002649, 0.7733100059897586, 0.16485790571629788, 0.5333463778086605, 0.45100315519856105, 0.9641218264967677, 0.4792626445007503, 0.09373540974616645, 0.8675860825181096, 0.2150051521224675, 0.9932918444747154, 0.8489608225931701, 0.26138033938940797, 0.5665305717396032, 0.9651800647769891, 0.9470350837118486, 0.9648923097100258, 0.5934244871418612, 0.6284700940177357, 0.29240536540651474, 0.9660110763610089, 0.28418941389810515, 0.7153782096526431, 0.12036417322332027, 0.36610971073794674, 0.30834903862004026, 0.32416334812014336, 0.5983757824709114, 0.16686235156801676, 0.3074130892116236, 0.36769786562716833, 0.1277060222540053, 0.9479021159411123, 0.10343480185295206, 0.8058611594902639, 0.47772099049175276, 0.4905919605093718, 0.34766319692066106, 0.9129465273931875, 0.6361019502453463, 0.8842871210232479, 0.23535735131119073, 0.9873672568871731, 0.18242300724854754, 0.1120404251868925, 0.1401057259703482, 0.13126733486537845, 0.18577922572430972, 0.7764357812058545, 0.7898478610172311]
target_r = [0.0010538224455385757, 0.00043140733379025837, 0.0013711608653507823, 8.218833276818534e-5, 0.0007393400070251927, 0.0009976254456791399, 0.001965832394695299, 0.0005342927619301842, 0.0002544213024750412, 0.0013412422412336007, 0.0017736456211318121, 0.0017210692969282756, 0.0022333696326507467, 0.001019491696936595, 0.00214670488019426, 0.0005638900164539, 0.0005753716602846718, 0.0004198203000997779, 0.001936422135508805, 0.001271078191665697, 0.0010524004153141813, 0.0004368903916348384, 0.0009516496287728248, 0.0016636373783362913, 0.0019818327427167533, 0.00218586918898681, 0.0008522502463236613, 0.0011149372138463595, 0.0006264884435021443, 0.0018634860932178938, 1.1746530558229563e-5, 0.0018386512359401372, 0.0007676894875863344, 0.0007818946537426913, 0.00029355206614058973, 0.0014322140993828255, 6.0075313887598784e-5, 0.0015149849197261516, 0.0005876194650898728, 0.0013349301196240837, 0.001466921201597895, 0.0009629236842440556, 0.0020118206923700546, 0.002042893755065856, 0.0022942514625351297, 0.0010240040387975067, 3.116806355523609e-5, 0.0016747837581295635, 0.00023256977090569403, 0.0010549498345293117, 0.0004003330703426012, 0.0014676190356347528, 0.002050989513039559, 0.0022813978793140856, 0.0009828758348769699, 0.002032182793588799, 0.0016318885478732359, 0.00020432257815802092, 0.0021494951617482736, 0.0019804317883191924, 0.0012832940847748518, 0.0007739202744126921, 0.00037190322378509173, 0.00014504210226532296, 0.0015517173032873468, 0.00048087706709479695, 0.0011270253426590574, 0.002239676048734343, 0.002158166894321812, 0.0017857406932944597, 0.001555281197727276, 0.0008260905149518475, 0.002032173686755459, 0.0009051467153573588, 0.0011394817508337766, 0.00011899672518863517, 0.001756227809460645, 0.0023044007736231164, 0.00037377636197371677, 0.0006385218907637081, 0.0012964092518955638, 0.0020536176546095547, 0.0002212722744335352, 0.0017570864772251283, 0.00012745100395832604, 0.001512667634453969, 0.0018562326886951874, 0.0009892416220414703, 0.002177850866629589, 0.0020288221904028935, 0.0019106613892481935, 0.0021093696345673035, 0.00018353386879342101, 0.0007741118648003775, 0.00029699238245099236, 0.0004553643543405239, 0.002091614168738691, 0.0020748260073115824, 0.00023072591540987343, 0.0006346989384966611, 0.0010894314825230006, 1.9835585161163156e-5, 0.0014095849623255666, 0.001222084562200885, 0.0007009828486111248, 0.0019890287627546306, 0.0003061502163699206, 0.0020516029224728273, 3.603853994766994e-5, 0.0008801142549603198, 0.0008092748670286799, 0.0014257880924067154, 0.0019748357455791786, 0.0003032148865299946, 0.001056616342326069, 0.0005535154186849013, 0.0016185346183202607, 0.0006754127167315931, 0.0021241538276260703, 0.0005148765398239043, 0.0001638458155563679, 0.0005550280989959784, 0.0005740392587453303, 0.001224475225773979, 0.0012499379011642426, 0.0013748436800389827, 0.0012011840429803655, 0.0005083567752237493, 0.0008077434536527172, 0.002273629685221349, 0.000988984732512483, 0.001992219325750487, 0.0010079453423968924, 0.0015282323630024667, 0.000956177100181838, 0.0021056872573755685, 0.0015409133734831711, 0.0017061755317079826, 0.0002845017453611776, 0.002198105647278717, 0.0011355721791023016, 1.6014676440902352e-5, 0.0015394640830381143, 0.0001773936552039745, 0.001641775198709003, 0.0019524296998681718, 0.0012859904776638977, 0.0015868305486789428, 0.001040610734662376, 0.00013533059818578237, 0.0008023403731696197, 0.0002725976612412738, 0.0015572165437715507, 0.0003753406770255591, 0.0016242758403279642, 0.0015748031276739502, 0.00016607888542591805, 0.001382878877346936, 0.0012025013674356753, 0.0011074701990677592, 0.0019098961728116594, 0.00215266226730457, 0.0019153278892225945, 0.0013061748186780292, 0.00017746195199510096, 0.0009584361036171869, 4.129656907187407e-5, 0.0006579723060241765]

target_center = SVector{3}([0.37701523887769656, 0.8732307103212446, 0.6249699520951716])
source_center = SVector{3}([0.8729001754981502, 0.3746384378914067, 0.12487979957447048])
target_radius = 0.2100686396067002
source_radius = 0.2091692328276295
target_box = SVector{3}([0.12293771141629767, 0.12300303936460133, 0.12473012898374536])
source_box = SVector{3}([0.1250334356440036, 0.12493383065482272, 0.12145833386626845])

source_bodies_matrix = zeros(5,length(source_x))
for i in 1:length(source_x)
    source_bodies_matrix[1:3,i] .= source_x[i]
    source_bodies_matrix[4,i] = source_r[i]
    source_bodies_matrix[5,i] = source_m[i]
end

source_system = Gravitational(source_bodies_matrix)

target_bodies_matrix = zeros(5,length(target_x))
for i in 1:length(target_x)
    target_bodies_matrix[1:3,i] .= target_x[i]
    target_bodies_matrix[4,i] = target_r[i]
    target_bodies_matrix[5,i] = target_m[i]
end

target_system = Gravitational(target_bodies_matrix)

# build branches
expansion_order = 15
source_branch = Branch(1:length(source_x), 0, 0:-1, 0, 1, source_center, source_center, source_radius, source_radius, source_box, source_box, expansion_order)
target_branch = Branch(1:length(target_x), 0, 0:-1, 0, 1, target_center, target_center, target_radius, target_radius, target_box, target_box, expansion_order)

# construct multipole expansion
body_to_multipole!(source_branch, source_system, source_branch.harmonics, expansion_order)

# evaluate multipole expansion
lamb_helmholtz = Val(false)
derivatives_switch = DerivativesSwitch(true, true, false, target_system)
FastMultipole.evaluate_multipole!(target_system, target_branch, source_branch, expansion_order, lamb_helmholtz, derivatives_switch)
multipole_potential = target_system.potential[1,:]

# perform M2L
ε = nothing
FastMultipole.multipole_to_local!(target_branch, source_branch, expansion_order, lamb_helmholtz, ε)
target_system.potential .= 0.0
FastMultipole.evaluate_local!(target_system, target_branch, expansion_order, lamb_helmholtz, derivatives_switch)
m2l_potential = target_system.potential[1,:]

# direct interaction
target_system.potential .= 0.0
direct!(target_system, source_system)
direct_potential = target_system.potential[1,:]

# get errors
error_mp = abs.(direct_potential - multipole_potential)
error_m2l = abs.(direct_potential - m2l_potential)

@show findmax(error_mp) findmax(error_m2l)

